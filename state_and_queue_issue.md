# Проблема гарантии при использовании очередей

1. Статья описывает неразрешимую проблему гарантии передачи сообщения с применением очередей внешнему потребителю.



# Задача

1. Имеем очередь Q с перечнем сообщений.
2. Потоку T Необходимо выполнить передачу сообщения во внешнее Состояние S (сервис, БД или иное).
3. S вовзращает синхронный ответ при успехе сохранения сообщения.
4. Требуется гарантировать:
    1. однократное сохранение каждого сообщения из Q в S или
    0. однозначный ответ о невозможности сохранения сообщения в S.



# Проблема

1. Поток Т читает очередное сообщение из Q.
    1. При успехе выполняет запись в S.
        1. При успехе выполняет коммит Q.
            1. При провале возникает неразрешимая ПРОБЛЕМА.
        0. При провале коммит Q не выполняется и обработка будет повторена.
    0. При провале коммит обработка будет повторена..
0. Варианты:
    1. ```T[ r(Q1) - w(S) # c(Q) ]``` - S может полчить дубликаты сообщения.
    0. ```T[ r(Q1) - c(Q) # w(S) ]``` - S может не получить сообщения.



# Вывод

1. Не существует технического решения при котором поток Т может гарантировать однократное сохранеие каждого сообщения из Q в S при описанных условиях.
2. Никакие компенсаторные механизмы со стороны Т не могут разрешить указанную проблему.



# Вариант решения

1. S должна обладать защитой от дублированного получения сообщения.
