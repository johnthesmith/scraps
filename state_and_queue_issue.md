# Проблема гарантии полноты и неизбыточности передачи сообщений при использовании очередей

1. Статья 
    1. описывает проблему гарантии полноты и неизбыточности при передачи сообщений из очереди внешнему потребителю.
    0. выдвигает гипотезу о невозможности разрешения проблемы без участия внешнего потребителя.



# Задача

1. Имеем очередь Q с перечнем сообщений.
0. Поток T передаёт сообщения во внешнее состояние S (сервис, БД или иное).
0. S возвращает синхронный ответ при успехе сохранения и не более.
0. Требуется гарантировать полноту и не избыточность сообщений при передаче из Q в S.



# Проблема

1. Поток Т читает очередное сообщение из Q.
    1. При успехе выполняет запись в S.
        1. При успехе выполняет коммит Q.
            1. При провале возникает неразрешимая проблема при которой состояние S изменено а очередь Q не информирована об успехе.
        0. При провале коммит Q не выполняется и обработка будет повторена.
    0. При провале обработка будет повторена.
0. Формальные варианты на основе [синтаксиса](msa_sintax.md):
    1. ```T[ r(Q) - w(S) # c(Q) ]``` - S может полчить дубликаты сообщения.
    0. ```T[ r(Q) - c(Q) # w(S) ]``` - S может не получить сообщения.



# Гипотеза

1. Не существует решения при котором поток Т гарантирует однократное сохранеие каждого сообщения 
из очереди Q в состояние S, при том что S возвращает исключительно синхронный ответ о результате 
сохранения, иными словами T не может гарантировать полноту и неизбыточность передачи сообщений.
2. Никакие компенсаторные механизмы со стороны Т не могут разрешить указанную проблему.


# Вариант решения

1. S должно обладать защитой от дублированного получения сообщения.
0. S должно обладать возможностью асинхронного оповещения T о результатах сохранения.
