# Принципиальная детерминированность нейросетей и безопасность

[en](../en/nn-determinism.md)

По роду деятельности сталкиваюсь с утверждением, о принципиальной 
недетерминированносте нейросетей при одинаковых входных данных.

УТВЕРЖДАЮ: для любой нейросети вида `r=f(a,w)` любого типа (LLM, сверточная и 
др.), при фиксированных аргументах `a`, фиксированных весах `w` и идентичных 
условиях исполнения, результат `r` детерминирован. Любая вариация результата без 
изменения `a`, `w` или условий исполнения является ошибкой реализации.

Отдельно необходимо отметить реккуретные сети вида `r1=f(a,w,r0)` где результат 
`r1` явно зависит от предудещего состояния `r0`. Однако и в этом случе при 
прочих равных включая `r0`, результат `r1` обязан быть детерминированным.

Утвреждение так же распространяется на процесс обучения `w=l(a, p)`, где `w` 
итоговые веса, `a` аргументы обучения, `p` данные для обучения.

Разберём возможные возражения, которые часто называют причиной 
недетерминированности



## Недетерминированность входных данных

*Возражение*: сеть принципиально недетерминирована из-за случайных значений при 
инициализации.

*Опровержение*: все численные значения, включая веса, фиксированы; внутренней 
случайности без изменения аргументов нет. Любое нарушение условия идентичных 
аргументов для последовательных вычислений является ошибкой реализации.



## Аппаратная недетерминированность

*Возражение*: результат может меняться из-за аппаратной недетерминированности.

*Опровержение*: при идентичном железе, точности, аппаратная 
недетерминированность исключена, наличие детерминированности говорит об 
аппаратных ошибках и исключает валидный результат.



## Софтовая недетерминированность

*Возражение*: результат может меняться из-за реализации в программном 
обеспечении включая версии библиотек, внутреннее кеширование или оптимизации.

*Опровержение*: При идентичном програмном окружении, версиях библиотек результат 
либо гарантированно детерминирован либо его следует классифицировать как ошибку 
программного обеспечения.



## Алгоритмическая недетерминированность

*Возражение*: результат может меняться из-за алгоритмической 
недетерминированности, включая параллельное исполнение, гонки и порядок 
операций.

*Опровержение*: недетерминированность без изменения входов = баг. Алгоритм 
обязан давать один результат при фиксированных данных и фиксированном порядке 
шагов. Если порядок «плавает», провоцируя для `x+y+z` результат 
`(x+y)+z≠x+(y+z)`, это следует оценивать как некорректную реализацию.



## Внешние факторы

*Возражение*: сеть может давать разные результаты из-за нечётких операций 
(квантовые факторы) и параметры внешнего мира (измерения).

*Опровержение*: любой параметр внешнего мира, включая квантовые операции и 
другие внешние факторы, может быть отражён только через аргументы модели. Если 
фактор напрямую влияет на результат без явного включения в аргументы, это ошибка 
реализации.



# Действия

Разберу, какие действия следует предпринять при обнаружении 
недетерминированности в модели.



## Признание проблемы

Наличие недетерминированности является индикатором проблемы. Следует признать 
проблему, указать на ее наличие.



## Анализ проблемы

При обнаружении недетерминированности источник проблемы необходимо определить и 
классифицировать по одной из категорий, рассмотренных выше:
1. Аргументы — случайность во входах или весах, незарегистрированные изменения 
   состояний и прочее.
2. Аппаратная недетерминированность — отличается порядок операций, ошибки 
   железа.
3. Софтовая недетерминированность — версия библиотек, оптимизации.
4. Алгоритмическая недетерминированность — ошибки реализации, параллелизм, 
   нарушение последовательности операций. 



## Устранение проблемы

По результатам анализа необходимо предпринять меры для устраненя проблемы с 
демонстрацией возможности детерминированного результата.



## Реализация недетерминируемости

Допускаю, случаи необходимости "случайности". Однако, они должны быть явно 
включены в аргументы модели с возможностью последовательного испытания на 
идентичных аргументах. При этом модель обязана по прежнему демонстрировать 
детерминируемость.



# Выводы

На основе изложенного предлагаю следующие выводы:

1. считаю, утверждение о **принципиальной** недетерминированности математической 
нейросети свидетельствует об отсутствии информации о происходящем либо о 
сокрытии ошибок на аппаратном, программном или алгоритмическом уровнях.
2. Невозможность демонстрации нейросетью детерминированных результатов следует 
считать опасной проблемой из за непредсказуемости, требующей решения, особенно 
при применении в business-critical и mission-critical системах.
3. применение любых моделей для mission-critical и business-critical систем 
должно основываться на понимании источников недетерминированности её описания и 
контроля.
4. Реализация детерминированного пайплайна исполнения нейросети должна быть
приоритетной сознательной целью.



# Заключение

Обобщенно: обсуждение безопасности развития нейросетей в частности и AI в целом 
должно быть основано на достижении гарантируемой повторяемости и проверяемости 
результатов работы AI. Это реально.

---

PS. Недетерминизм - это баг в пайплайне, а не фича. Его необходимо устранить.
