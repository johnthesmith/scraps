# Таймозны в веб приложении

## Определения
+ Client - любое приложение (включая веб браузер), размещенное на клиентском оборудовани.
+ Back - сервис являющийся конечным звеном формирования пользовательского контента и данных.
+ Back components - перечень средств хранения и обработки данных на стороне Back.
+ Core - зона контролируемая разработчиком.
+ Foe - зона контролируемая клиентом.
+ TZ - time zone

## Ситуация
Предполагаем использования времени UTC+0 для всех Back и Back Components, вне зависимости от фактического временного пояса.

Предположение избавляет от необходимости сопряжения временных зон на уровне компонентов Back и облегчает задачу управления. Является желательным но не обязательным, для рассматриваемой темы. В случае различных TZ для Back Components возлагается на Core.

## Задача
Реализовать работу пользоваетелей на Client в разных часовых поясах. 

## Варианты
Рассмотрим два варианта перевода времени из UTC+0 в локальную TZ клиента.

![Рассматриваемаые варианты](//images/TimeZoneFrienOrFoe.png "")
![Рассматриваемаые варианты](https://github.com/johnthesmith/scraps/blob/main/images/TimeZoneFrienOrFoe.png)

### A. Таймозона на back

*Суть*: Конверсия момента времени осуществляется на стороне Friend в Back сервисе.

1. Client работает в произвольной таймзоне. 
0. Данные с Client на Back присылаются как есть. 
0. Back имеет однозначные *внутренние* правила Rules обработки времени от каждого из клиентов. 
0. Получая от клиента момент времени Back на основании меющихся правил корректирует присланное клиентом значение времени в UTC+0 и пропускает данные далее в ядро.
0. Core произовдит работу с моментами времени в UTC+0.
0. Возвращаемые на Client моменты времени корректируются согласно Rules в готовом для исползования на CLient виде.
0. Client использует данные на свое усмотрение.

### B. Таймзона на front

Суть:Конверсия момента врмени осущствляется на стороне Foe буквально следуя концепции "Представление данных - вопрос клиента"

1. Client работает в произвольной таймзоне. 
0. Данные от Сlient на Back присылаются с учетом коррекции правил Rule размещенных на клиенте.
0. Back исходит из предположения что данные валидны, представлены в необходимом формате, содержат информацию о коректной TimeZone, и представлены в UTC+0.
0. Core произовдит работу с моментами времени в UTC+0.
0. Моменты времени возвращаютяся на Client в UTC+0 в соответсвии с концепцией "Представление данных - вопрос клиента".
0. Client получает данные в UTC+0 интерпритирует их на основе локальных Rule в необходимео для представления пользователю вид.

Представленные варианты имеют принципиальное различие, а именно точку конверсии данных в доступный пользователю вид.
Оценивать место расположения точки конверсии данных необходимо исключительно из позиции "Клиент находится в руказ врага". 

### Достоинства варианта А

1. Контролируемость результатов, получаемых конечным пользователем.
0. Core гарантированно выводит себя из под вопросов о оезультатах интерпритации данных на стороне клиента.
0. Core гарантирует однозначность Rule и исключает влияние User на возвращаемые результаты.
0. Core имеет возможность доказать и продемонстрировать валидность и целостность данных.   

### Недостатки варианта Б

1. Так как Rule расположениы на неподконтрольной территории, они могут быть намерянно или случайно искажены.
0. Core не имеет пркатической возможности подтвердить или опровергнуть внесенные изменения.
0. Соre вынуждена доверять полученным данным и использовать их на совей стороне как истиные.
    
### Выводы
1. Вариант A cчитаю единственно возможным к реализации в распределенной системе для пользователей в различных часовых поясах.
0. Вариант Б содержит концептуальные недостатки, которые могут быть лишь отчасти компенсированы методами реализации.
0. Вариант А не нарушает принципа "представлени данных - вопрос клиента" так как время, часовой пояс, формат представления для каждого клиента являются исключительно элементами бизнес-логики, зависящи от настроек Core и полномочий пользователй, а следовательно не могут быть переданаы на Client.
